<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bolt AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{
      --bg:#0b0b0b;
      --panel:#111214;
      --panel-2:#15171a;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --border:#1f2937;
      --accent:#00C853; /* change to #1B5E20 or #00E676 if you prefer */
      --accent-2:#00a846;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background-color: var(--bg);
      display: flex;
      height: 100vh;
      overflow: hidden;
      color: var(--text);
    }

    /* ====== SIDEBAR (Desktop default) ====== */
    #sidebar {
      width: 280px;
      background: var(--panel);
      color: var(--text);
      display: flex;
      flex-direction: column;
      padding: 1rem;
      border-right: 1px solid var(--border);
      z-index: 5;
      transition: transform .25s ease, opacity .25s ease;
    }
    #sidebar h1 {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 0 0 1rem 0;
      color: var(--text);
    }
    #chatList { flex: 1; overflow-y: auto; padding-top: 1rem; }
    .chatItem {
      display: flex; justify-content: space-between; align-items: center;
      background-color: var(--panel-2);
      padding: 0.6rem 0.8rem; margin-bottom: 0.5rem;
      border-radius: 10px; font-size: 0.95rem; cursor: pointer;
      transition: background 0.2s, border 0.2s; border: 1px solid transparent; color: var(--text);
    }
    .chatItem:hover { border-color: var(--border); }
    .deleteBtn { background: none; border: none; color: #f87171; font-size: 1rem; cursor: pointer; margin-left: 0.5rem; }

    /* ====== MAIN ====== */
    #main { flex: 1; display: flex; flex-direction: column; background-color: var(--panel); }

    #topBar {
      display: flex; justify-content: space-between; align-items: center;
      padding: 0.8rem 1rem; border-bottom: 1px solid var(--border);
      background-color: var(--panel-2); gap: .75rem; flex-wrap: wrap;
    }

    select{
      font-size: 0.95rem; padding: 0.45rem 0.65rem; border-radius: 10px;
      border: 1px solid var(--border); background: #0f1113; color: var(--text); outline: none;
    }

    button{
      padding: 0.6rem 1rem; background-color: var(--accent); color: #061007;
      border: none; border-radius: 10px; font-size: 0.95rem; cursor: pointer;
      transition: transform .05s ease, background .2s ease; font-weight: 600;
    }
    button:hover{ background-color: var(--accent-2); }
    button:active{ transform: translateY(1px); }

    #chatContainer{
      flex: 1; overflow-y: auto; padding: 2rem; background-color: var(--panel);
    }

    .message{
      max-width: 80%; padding: 1rem 1.2rem; margin-bottom: 1rem; border-radius: 14px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.25); font-size: 1rem; line-height: 1.5;
      border: 1px solid var(--border); color: var(--text);
    }
    .user{ align-self: flex-end; background: rgba(0,200,83,0.12); border-color: rgba(0,200,83,0.35); }
    .bot{ align-self: flex-start; background: #0f1113; }

    #welcomeBanner{ text-align: center; color: var(--muted); font-size: 1.2rem; margin-top: 3rem; }

    #newChatBtn{ margin-bottom: 1rem; background-color: var(--accent); color:#061007; }
    #newChatBtn:hover{ background-color: var(--accent-2); }

    /* Files row */
    #fileDisplay{
      display: flex; flex-wrap: nowrap; overflow-x: auto; font-size: 0.75rem;
      padding: 6px 12px; border-top: 1px solid var(--border);
      background-color: #0f1113; color: #d1fae5; align-items: center; gap: 12px;
    }
    .fileBadge{
      background-color: rgba(0,200,83,0.12); border: 1px solid rgba(0,200,83,0.35);
      padding: 2px 6px; border-radius: 8px; white-space: nowrap; display: flex; align-items: center; gap: 6px; color:#a7f3d0;
    }
    .fileBadge button{ all: unset; color:#f87171; cursor: pointer; font-weight: bold; margin-left:4px; }
    .fileBadge span{ font-size: 0.8rem; }

    /* ====== PILL INPUT BAR ====== */
    #inputArea{ border-top: 1px solid var(--border); background-color: var(--panel-2); padding: 1rem; position: relative; }
    .inputPill{
      display: flex; align-items: center; gap: .6rem; background: #0f1113;
      border: 1px solid var(--border); border-radius: 9999px; padding: .5rem .5rem;
    }
    #plusBtn{
      width: 40px; height: 40px; border-radius: 999px; background: transparent; color: var(--text);
      border: 1px solid var(--border); display: grid; place-items: center; font-size: 20px;
    }
    #plusBtn:hover{ border-color: var(--accent); color: var(--accent); background: #0c1110; }
    textarea{
      flex: 1; resize: none; padding: .9rem 1rem; border-radius: 9999px; font-size: 1rem;
      border: none; outline: none; height: 2.8rem; color: var(--text); background: transparent;
    }
    #sendBtn{
      width: 44px; height: 44px; border-radius: 9999px; display: grid; place-items: center;
      font-size: 18px; padding: 0; color: #061007; background: var(--accent);
    }
    #sendBtn:hover{ background: var(--accent-2); }

    /* Quick actions popover */
    #quickActions{
      position: absolute; bottom: 84px; left: 24px;
      background: #0f1113; border: 1px solid var(--border); border-radius: 12px; padding: .5rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35); display: none; min-width: 260px; z-index: 50;
    }
    .qa-item{
      display: flex; align-items: center; gap: .6rem; padding: .6rem .7rem; border-radius: 10px;
      cursor: pointer; color: var(--text); text-decoration: none;
    }
    .qa-item:hover{ background: rgba(255,255,255,0.05); color: var(--accent); }
    .qa-item span.icon{ font-size: 1.1rem; width: 1.4rem; text-align: center; }

    /* ====== MOBILE MODE TOGGLE STYLES ====== */
    #layoutToggle{ background: transparent; border: 1px solid var(--border); color: var(--text); }
    #layoutToggle:hover{ border-color: var(--accent); color: var(--accent); background:#0c1110; }

    #hamburger{
      display: none; /* shown in .mobile-mode */
      background: transparent; border: 1px solid var(--border); color: var(--text);
      padding: .5rem .7rem; border-radius: 10px; font-weight: 700;
    }
    #hamburger:hover{ border-color: var(--accent); color: var(--accent); }

    .mobile-mode body { overflow: hidden; }
    .mobile-mode #sidebar{
      position: absolute; left: 0; top: 0; bottom: 0;
      transform: translateX(-100%); opacity: 0;
      width: 84vw; max-width: 360px;
      border-right: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0,0,0,.5);
    }
    .mobile-mode #main{ flex: 1; }
    .mobile-mode #hamburger{ display: inline-flex; align-items:center; gap:6px; }
    .mobile-mode #sidebarBackdrop{
      position: absolute; inset: 0; background: rgba(0,0,0,0.35);
      display: none; z-index: 4;
    }
    .mobile-mode.sidebar-open #sidebar{ transform: translateX(0); opacity: 1; z-index: 6; }
    .mobile-mode.sidebar-open #sidebarBackdrop{ display: block; }

    /* keep everything else same */
  </style>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BT7DVWBW5Y"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-BT7DVWBW5Y');
  </script>
</head>
<body>

<!-- Backdrop for mobile sidebar -->
<div id="sidebarBackdrop"></div>

<div id="sidebar">
  <div style="display: flex; align-items: center; gap: 0.6rem; margin-bottom: 1rem;">
    <img src="https://i.postimg.cc/Kz82Wdg5/bolt-logo.png" alt="Bolt Logo" style="height: 36px; width: 36px; border-radius: 6px;" />
    <h1 style="margin: 0; font-size: 1.1rem;">Bolt by Abir Singh</h1>
  </div>

  <button id="newChatBtn" onclick="startNewChat()">+ New Chat</button>
  <div id="chatList"></div>
</div>

<div id="main">
  <div id="topBar">
    <div style="display:flex; gap:.5rem; align-items:center;">
      <!-- Hamburger appears in mobile mode only -->
      <button id="hamburger" title="Open chats">‚ò∞</button>
      <select id="modelSelect" onchange="setModel()">
        <option value="Bolt O4 Nexus">Bolt O4 Nexus ‚Äì Everyday Assistant</option>
        <option value="Bolt O5 Forge">Bolt O5 Forge ‚Äì Coding Expert</option>
        <option value="Bolt O6 Vita">Bolt O6 Vita ‚Äì Health & Wellness Specialist</option>
        <option value="Bolt O7 Quill">Bolt O7 Quill ‚Äì Writing Assistant</option>
        <option value="Bolt O8 Polyglot">Bolt O8 Polyglot ‚Äì Elite Translation Companion</option>
        <option value="Bolt O9 Ledger">Bolt O9 Ledger ‚Äì Finance & Management Guru</option>
      </select>
    </div>
    <div style="display:flex; gap:.5rem; align-items:center;">
      <button id="layoutToggle" title="Toggle Desktop/Mobile">Toggle Layout</button>
    </div>
  </div>

  <div id="chatContainer"></div>
  <div id="fileDisplay"></div>

  <div id="inputArea">
    <div class="inputPill">
      <button id="plusBtn" title="Quick actions">+</button>
      <textarea id="userInput" placeholder="Type your question here..."></textarea>
      <button id="sendBtn" onclick="sendMessage()" title="Send">‚Üë</button>
    </div>
    <!-- Quick actions popover -->
    <div id="quickActions">
      <a class="qa-item" href="https://932f549d6329f527a5.gradio.live/" target="_blank" rel="noopener">
        <span class="icon">üì∑</span> Image generator
      </a>
      <a class="qa-item" href="https://forms.office.com/r/33SKdMEZ03" target="_blank" rel="noopener">
        <span class="icon">üí°</span> Suggest a Feature
      </a>
      <div class="qa-item" onclick="uploadFile()">
        <span class="icon">üìé</span> Upload PDF/Image (OCR)
      </div>
      <a class="qa-item" href="https://github.com/IsherCoder/bolt/raw/main/terms%20and%20conditions.pdf" target="_blank" rel="noopener">
        <span class="icon">üìÑ</span> Terms & Conditions
      </a>
    </div>
  </div>
</div>

<script>
  /* ====== Existing logic (unchanged) ====== */
  const chatContainer = document.getElementById('chatContainer');
  const modelSelect = document.getElementById('modelSelect');
  const input = document.getElementById('userInput');
  const chatList = document.getElementById('chatList');

  let chatHistory = [];
  let selectedModel = localStorage.getItem("selectedModel") || "Bolt O4 Nexus";
  let currentChatId = null;
  modelSelect.value = selectedModel;

  const modelWelcomeMessages = {
    "Bolt O4 Nexus": "üëã Hey there! I‚Äôm Bolt O4 Nexus ‚Äì your everyday assistant. Ask me anything.",
    "Bolt O5 Forge": "üßë‚Äçüíª Welcome! I'm Bolt O5 Forge, your coding wizard. Let‚Äôs build something cool.",
    "Bolt O6 Vita": "üí™ Hello! I‚Äôm Bolt O6 Vita ‚Äì here for your health, fitness, and wellness goals.",
    "Bolt O7 Quill": "‚úçÔ∏è Greetings! I‚Äôm Bolt O7 Quill ‚Äì your writing expert. Need help drafting brilliance?",
    "Bolt O8 Polyglot": "üåç Bonjour! I‚Äôm Bolt O8 Polyglot ‚Äì your elite translation companion.",
    "Bolt O9 Ledger": "üíº Welcome! I‚Äôm Bolt O9 Ledger ‚Äì your finance and management partner. Let‚Äôs talk strategy."
  };

  function setModel() {
    selectedModel = modelSelect.value;
    localStorage.setItem("selectedModel", selectedModel);
    renderChat();
  }

  function saveChat() {
    const allChats = JSON.parse(localStorage.getItem("boltChats") || "{}");
    allChats[currentChatId] = chatHistory;
    localStorage.setItem("boltChats", JSON.stringify(allChats));
    loadChatList();
  }

  function loadChatList() {
    chatList.innerHTML = "";
    const allChats = JSON.parse(localStorage.getItem("boltChats") || "{}");
    Object.keys(allChats).forEach(id => {
      const firstMsg = allChats[id].find(m => m.role === "user");
      const title = firstMsg ? firstMsg.content.slice(0, 30) + "..." : "Untitled Chat";

      const div = document.createElement("div");
      div.className = "chatItem";

      const titleSpan = document.createElement("span");
      titleSpan.textContent = title;
      titleSpan.style.flex = "1";
      titleSpan.onclick = () => { loadChat(id); if (document.body.classList.contains('mobile-mode')) closeSidebarMobile(); };

      const delBtn = document.createElement("button");
      delBtn.className = "deleteBtn";
      delBtn.innerHTML = "üóëÔ∏è";
      delBtn.onclick = (e) => {
        e.stopPropagation();
        deleteChat(id);
      };

      div.appendChild(titleSpan);
      div.appendChild(delBtn);
      chatList.appendChild(div);
    });
  }

  function deleteChat(id) {
    const allChats = JSON.parse(localStorage.getItem("boltChats") || "{}");
    delete allChats[id];
    localStorage.setItem("boltChats", JSON.stringify(allChats));

    const files = JSON.parse(localStorage.getItem("boltFiles") || "{}");
    delete files[id];
    localStorage.setItem("boltFiles", JSON.stringify(files));

    if (currentChatId === id) {
      chatHistory = [];
      currentChatId = null;
      renderChat();
    }

    loadChatList();
  }

  function loadChat(id) {
    currentChatId = id;
    chatHistory = JSON.parse(localStorage.getItem("boltChats"))[id];
    renderChat();
  }

  function startNewChat() {
    chatHistory = [];
    currentChatId = Date.now().toString();
    renderChat();
  }

  function renderChat() {
    chatContainer.innerHTML = "";
    if (!chatHistory.length) {
      const welcome = modelWelcomeMessages[selectedModel] || "üëã Hello, I‚Äôm Bolt. How can I help you today?";
      chatContainer.innerHTML = `<div id="welcomeBanner">${welcome}<br><br>Click ‚Äú+ New Chat‚Äù to begin.</div>`;
    }
    chatHistory.forEach(msg => {
      const bubble = document.createElement("div");
      bubble.className = "message " + (msg.role === "user" ? "user" : "bot");
      bubble.textContent = msg.content;
      chatContainer.appendChild(bubble);
    });
    chatContainer.scrollTop = chatContainer.scrollHeight;
    renderFiles();
  }

  function renderFiles() {
    const allFiles = JSON.parse(localStorage.getItem("boltFiles") || "{}");
    const files = allFiles[currentChatId] || [];
    const display = document.getElementById("fileDisplay");
    display.innerHTML = "";

    files.forEach((f, index) => {
      const badge = document.createElement("div");
      badge.className = "fileBadge";
      badge.innerHTML = `üìÑ ${f} <span>‚úÖ</span> <button onclick="removeFile(${index})">‚úñ</button>`;
      display.appendChild(badge);
    });
  }

  function removeFile(index) {
    const allFiles = JSON.parse(localStorage.getItem("boltFiles") || "{}");
    if (!allFiles[currentChatId]) return;
    allFiles[currentChatId].splice(index, 1);
    localStorage.setItem("boltFiles", JSON.stringify(allFiles));
    renderFiles();
  }

  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    const userMsg = { role: "user", content: text };
    chatHistory.push(userMsg);
    input.value = "";
    renderChat();

    const botMsg = { role: "assistant", content: "" };
    chatHistory.push(botMsg);
    const bubble = document.createElement("div");
    bubble.className = "message bot";
    chatContainer.appendChild(bubble);
    chatContainer.scrollTop = chatContainer.scrollHeight;

    const res = await fetch("/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        history: chatHistory,
        selected_model: selectedModel,
        custom_context: localStorage.getItem("boltCustomContext") || ""
      })
    });

    const reader = res.body.getReader();
    const decoder = new TextDecoder();
    let fullText = "";

    while (true) {
      const { done, value } = await reader.read();
      if (done) break;
      const chunk = decoder.decode(value);
      fullText += chunk;
      bubble.textContent = fullText;
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    botMsg.content = fullText;
    saveChat();
  }

  function uploadFile() {
    const file = document.createElement('input');
    file.type = 'file';
    file.accept = '.pdf,.docx,image/*,.webp'; // PDFs, Word, and images
    file.onchange = async () => {
      const selected = file.files[0];
      if (!selected) return;

      const formData = new FormData();
      formData.append("file", selected);

      const nameLower = selected.name.toLowerCase();
      let endpoint = "";

      if (nameLower.endsWith(".pdf") || selected.type === "application/pdf") {
        endpoint = "/upload";
      } else if (nameLower.endsWith(".docx") ||
                 selected.type === "application/vnd.openxmlformats-officedocument.wordprocessingml.document") {
        endpoint = "/upload";
      } else if (selected.type.startsWith("image/") ||
                 /\.(png|jpe?g|webp|bmp|tiff?)$/i.test(nameLower)) {
        endpoint = "/ocr";
      } else {
        alert("‚ùå Unsupported file type. Please upload a PDF, DOCX, or an image.");
        return;
      }

      try {
        const res = await fetch(endpoint, { method: "POST", body: formData });
        const data = await res.json();

        if (data.extracted_text) {
          alert(endpoint === "/ocr" ? "üñºÔ∏è Image processed with OCR!" : "üìÑ File uploaded and processed!");

          const allFiles = JSON.parse(localStorage.getItem("boltFiles") || "{}");
          if (!allFiles[currentChatId]) allFiles[currentChatId] = [];
          allFiles[currentChatId].push(selected.name);
          localStorage.setItem("boltFiles", JSON.stringify(allFiles));

          // Append to existing custom context
          const prev = localStorage.getItem("boltCustomContext") || "";
          const combined = prev ? (prev + "\n\n" + data.extracted_text) : data.extracted_text;
          localStorage.setItem("boltCustomContext", combined);

          renderFiles();
        } else {
          alert("‚ùå Error: " + (data.error || "Unable to extract text."));
        }
      } catch (err) {
        alert("‚ùå Upload failed: " + err.message);
      }
    };
    file.click();
  }

  // Enter to send (unchanged)
  const inputEl = document.getElementById('userInput');
  inputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  // Quick actions popover toggle
  const plusBtn = document.getElementById('plusBtn');
  const quick = document.getElementById('quickActions');
  plusBtn.addEventListener('click', (e)=>{
    e.stopPropagation();
    quick.style.display = quick.style.display === 'block' ? 'none' : 'block';
  });
  document.addEventListener('click', ()=>{ quick.style.display = 'none'; });

  /* ====== NEW: Layout & Mobile Sidebar Toggles (UI only) ====== */
  const layoutToggle = document.getElementById('layoutToggle');
  const hamburger = document.getElementById('hamburger');
  const sidebarBackdrop = document.getElementById('sidebarBackdrop');

  const savedLayout = localStorage.getItem('boltLayout') || 'desktop';
  if (savedLayout === 'mobile') enableMobileMode(); else enableDesktopMode();

  layoutToggle.addEventListener('click', ()=>{
    if (document.body.classList.contains('mobile-mode')) {
      enableDesktopMode();
    } else {
      enableMobileMode();
    }
  });

  hamburger.addEventListener('click', ()=>{
    if (!document.body.classList.contains('mobile-mode')) return;
    document.body.classList.toggle('sidebar-open');
  });
  sidebarBackdrop.addEventListener('click', closeSidebarMobile);

  function enableMobileMode(){
    document.body.classList.add('mobile-mode');
    document.body.classList.remove('sidebar-open');
    layoutToggle.textContent = 'Switch to Desktop';
    localStorage.setItem('boltLayout','mobile');
  }
  function enableDesktopMode(){
    document.body.classList.remove('mobile-mode');
    document.body.classList.remove('sidebar-open');
    layoutToggle.textContent = 'Switch to Mobile';
    localStorage.setItem('boltLayout','desktop');
  }
  function closeSidebarMobile(){ document.body.classList.remove('sidebar-open'); }

  loadChatList();
  renderChat();
</script>
</body>
</html>
